---
title: "MA_Forecasts_DESCRIPTIVES"
author: "Anne Valder"
date: "7/18/2021"
output: html_document
---

TO DO:

- source('LocalReg_functions.r')    !!!!!!!!!

- HOW DO I PLOT AR(1) against GDP GR,coef against???

- first differences for search termns = check with ADF!!! 

ich nehm alle 24 broad kate und mach daraus einen PCA ! (knetsch hat dann die einzelnne cat PCA genommmen und mit diesen die soft indicator ersetzt die dann die hard indicator predicten) 

More precisely, for a given monthly indicator or GDP component, we allow the factors to load only on subcategories that correspond to the categories that we considered for the subjective approach outlined above (First, we compute the factor loadings unrestrictedly over all subcategories that ‘‘survive’’(logischer ausschluss von 9 katrgorein) the aforementioned pre- selection.(so wie ich bisher nru auf more granualr level mit sub data) Second, we group the eligible subcategories and subsequently draw category-specific factors (selbst zuornung von suub categor data to categ data) The reason for considering the latter is economic interpretability:
-However, we disregarded a priori nine categories that we deemed unfitting (Arts & Entertain- ment, Books & Literature, Games, Hobbies & Leisure, Online Communities, People & Society, Pets & Animals, Reference and Science), as well as several subcategories from Sensitive Subjects that were particularly prone to outliers or zero-values. In the end, our Google data set 200 series.

CII data Berechnungen von der EU geändert! financial data!!!!
https://ec.europa.eu/info/sites/default/files/new_cci.pdf
https://ec.europa.eu/newsroom/ecfin/items/642583

JA Forecasting geht!!! ich hab model getrained und hab dann für die kommenende MOnate noch die X's werte und die getrainted coefficients - nur einsetzen- BUT HOW to extract MiN coef from expanding regression!!!!!!! 

PaRAmetric vs non parametric forecasting...!

BMS - https://cran.r-project.org/web/packages/BMS/vignettes/bms.pdf

GRAPHS for predictive power...



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
#rm(list=ls())
library(readr)
library(readxl)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(Metrics)
library(gtrendsR)
library(tsbox)
library(zoo)
library(tseries)
library(tempdisagg)
library(x12)
library(trendecon)
library(pls)
library(prophet)
library(glmnet)
library(reshape2) 
library(caret) 
library(midasr)
library(lubridate)  
 
```

# Read in data (GDP & ConsumerConfidence & GT fertiger Indicator TrendEcon)
```{r}

getwd()
setwd("/Users/annevalder/Desktop/UNI /WU WIEN/SoSe_21/MA/data")

### GDO data ###
## Source: https://data.oecd.org/gdp/quarterly-gdp.htm#indicator-chart
GDP_qtrly <- read_csv("GDP_AT_Q12006.csv")[64:126,6:7] # unnötige columns weg und nur AT daten!

colnames(GDP_qtrly)[colnames(GDP_qtrly) %in% c("TIME", "Value")] <- c("QDate", "Value")
class(GDP_qtrly$Date)
class(GDP_qtrly$Value)
GDP_diff <- diff(GDP_qtrly$Value) 
adf.test(GDP_qtrly$Value) 
adf.test(GDP_diff) 

### test for cointegratio

library("urca")
jotest <- ca.jo(CCI_diff,GDP_diff, type="trace", K=2, ecdet="none", spec="longrun")
summary(jotest)
adf.test(CCI_qtrly$Value)
library(aTSA)
coint.test(GDP_diff,CCI_diff_Q, d = 1, nlag = NULL, output = TRUE)
kpss.test(CCI_mntly$Value)
PP.test(CCI_mntly$Value)
0#back <- lag(GDP_qtrly)
#forc <- lead(GDP_qtrly)


### Consumer Confidence data ###
##Source: https://ec.europa.eu/info/business-economy-euro/indicators-statistics/economic-databases/business-and-consumer-surveys/download-business-and-consumer-survey-data/time-series_en#consumers

#######change

#CCI_mntly<- read_xlsx("ConsumerConfidence.xlsx", sheet = "MONTHLY")[253:438,c(1,173)]#
#CCI_mntly<- read_xlsx("CCI.xlsx", sheet = "CONSUMER MONTHLY")[254:445,c(1,297)]

CCI_mntly<- read_xlsx("~/Desktop/Uni/WU WIEN/SoSe_21/MA/data/CCI.xlsx",sheet = "CONSUMER MONTHLY")[253:444,c(1,297)] # 297 ist Spalte KK - total index!

summary(CCI_mntly)


CCI_mntly <- CCI_mntly %>% data.frame() 
#CCI_mntly <- CCI_mntly[1:168,]
adf.test(CCI_mntly$Value)
CCI_diff <- diff(CCI_mntly$Value)
adf.test(CCI_diff) ## differneced then stationary!!!! 
cor(rep.dat)

CCI_diff_Q <- diff(CCI_qtrly$Value)
adf.test(CCI_diff_Q) 

#adf.test(CCI_mntly$Value)  #### non stationary!! - take diff???
#CCI_mntly <- diff(CCI_mntly$Value)

colnames(CCI_mntly)[colnames(CCI_mntly) %in% c("...1", "CONS.AT.TOT.COF.BS.M")] <- c("Date", "Value")
CCI_mntly$Value <- as.integer(CCI_mntly$Value)
############## CCI FIN !!!! wie heik.

CCI_mntly_fin <- read_xlsx("consumer_total_sa_nace2.xlsx", sheet = "CONSUMER MONTHLY")[254:439,c(1,298)]
CCI_mntly_fin <- CCI_mntly_fin %>% data.frame() 

colnames(CCI_mntly_fin)[colnames(CCI_mntly_fin) %in% c("...1", "CONS.AT.TOT.1.BS.M")] <- c("Date", "Value")
#problematic TIME Variable???

### Google Trends Data AT ###
## source: https://github.com/trendecon/data


#Google_AT_daily <- read_csv("trendecon_sa.csv")

Google_AT_daily <- read.csv("https://raw.githubusercontent.com/trendecon/data/master/data/at/trendecon_sa.csv")
Google_AT_daily <-  data.frame(Google_AT_daily) 
colnames(Google_AT_daily)[colnames(Google_AT_daily) %in% c("time", "value")] <- c("Date", "Value")
adf.test(Google_AT_daily$Value) ## stationary 

###### direct aus package!!! aktueller! 

#AT_indicator_TEC <- read.csv("https://raw.githubusercontent.com/trendecon/data/master/data/at/trendecon_sa.csv")
tsbox::ts_plot(Google_AT_daily, title = "Austria")

```

# Data Wrangling
```{r}

# problem mit GDPis characcter date column!
#will polty von GDP growth rates 
#Growth rate = (Present value - Past value)/ Past Value * 100
class(GDP_qtrly$Date) # Format ändern von Datum in GDP da nur in Q1"006 etc angegeben...

M <- 6
t_0 <- as.Date("2006-01-01") #Setting start date for our series
t_1 <- as.Date("2021-09-30") #Setting end date for our series
Date <- seq.Date(t_0,t_1,by="quarter") # set for quarterly data 
  bigT <- length(Date)

GDP_qtrly <- cbind(GDP_qtrly,Date)
Data   <- matrix(NA,bigT,M)    # rows are length of t, columns are numbers of variables from FRED 

colnames(Data)  <- c("GDP", "CCI", "Google","GDP_ts", "CCI_ts", "Google_ts")   
rownames(Data)  <- as.character(Date)

Data[(Date%in%GDP_qtrly$Date),1] <- (GDP_qtrly$Value)

## Construt TS data of GDP and also save in Matrix
GDP_qtrly_ts <- ts(data = GDP_qtrly$Value, frequency = 4,start = c(2006,1))




adf.test(GDP_qtrly_ts) #Type 3: with drift and trend 0,18


plot.ts(GDP_qtrly_ts, main ="Quarterly GDP Growth Rate (2006-2021)",xlab = "Years",ylab = "Austria's GDP growth (%)", )
#view(GDP_qtrly_ts, )
#GDP_qtrly_ts <- GDP_qtrly_ts %>% data.frame() 

Data[(Date%in%GDP_qtrly$Date),4] <- GDP_qtrly_ts

#GDP_qtrly_ts <- GDP_qtrly_ts %>% data.frame() 

summary(GDP_qtrly_ts)

plot.ts(Data[,4],main ="Quarterly GDP Growth Rate (2006-2021)",xlab = "Years",ylab = "Austria's GDP growth (%)")


names(x)[2]<-paste("Value")
names(df)[2]<-paste("time")
print(colnames(x))

df <- GDP_qtrly[1:11,c(2,3)]

df
df <- rbind(df,x)
GDP_qtrly_2 <- cbind(GDP_qtrly,df$Value)

GDP_qtrly_2 <- GDP_qtrly_2[1:57,]


ggplot(GDP_qtrly_2, aes(x=Date, y=Value,col = variable)) +
  geom_line(color = "steelblue") +
  theme_light() +
  labs(title = "Quarterly GDP Growth Rate (Q1 2006- Q2 2021)", x = "Years", y = "Austria's GDP growth (in%)")+
  theme(plot.title = element_text(hjust = 0.5, face ="bold")) +
  scale_x_date(limit=c(as.Date("2006-01-01"),as.Date("2021-06-30")),date_labels="%b %y",date_breaks  ="24 month")+
  scale_color_manual(labels = c("Day1", "Day2"), values = c("blue", "orange"))
  
ts.plot(ts(GDP_qtrly_2$Value,frequency = 12, start = c(2006,8)),
          ts(GDP_qtrly_2$`df$Value`,frequency = 12, start = c(2006,8)))


 ts.plot(ts(GDP_qtrly_2$Value,frequency = 4, start = c(2006,8)),
          ts(GDP_qtrly_2$`df$Value`,frequency = 4, start = c(2006,8)),
    col = c("red", "blue"),
    xlab = "Year", 
    ylab = "Search Frequency (Wirtschaftskrise)", 
    lwd = 1)
legend("bottomright", c("Tag 1", "Tag 2","Tag 3"), col=c("red","blue", "black"), lty=c(1),
       inset=c(0,1), xpd=TRUE, horiz=TRUE, bty="n"
       )
```
#### CCI data alle
```{r}
class(CCI_mntly$Value)
class(CCI_mntly$Date)

CCI_mntly$Date <- as.Date(CCI_mntly$Date)
CCI_mntly$Value <- as.numeric(CCI_mntly$Value)

CCI_mntly_ts <- ts(CCI_mntly$Value)

#summary(CCI_mntly_ts)

### PLOTS ###  HEIk nimmt financial CCI only!!!!! 
plot.ts(CCI_mntly_ts, main ="Consumer Confidence Austria 2006-2021 (Monthly)")

ggplot(CCI_mntly, aes(x=Date, y=Value)) +
  geom_line(color = "steelblue") +
  theme_light() +
    labs(title = "Consumer Confidence Austria 2006-2021 (Monthly)", x = "Years", y = "Austria's Consumer Confidence (total)")+
  theme(plot.title = element_text(hjust = 0.5, face ="bold")) +
  scale_x_date(limit=c(as.Date("2006-01-01"),as.Date("2021-06-30")),date_labels="%b %y",date_breaks  ="24 month")

#### Convert Monthly data into quarterly data!

CCI_mntly <- arrange(CCI_mntly, Date)
CCI_mntly$QDate <- as.yearqtr(CCI_mntly$Date)
CCI_mntly$QDate <- as.character(CCI_mntly$QDate)
CCI_mntly$QDate[CCI_mntly$QDate == "2021 Q4"] <- "2021 Q3"
CCI_mntly$QDate <- as.yearqtr(CCI_mntly$QDate)
CCI_qtrly <- CCI_mntly %>% group_by(QDate) %>%
  summarise_all(mean)

### save version! 
#for (i in 1:nrow(CCI_mntly)){
#  if(CCI_mntly$QDate[i]== "2021 Q2" | CCI_mntly$QDate[i]== "2021 Q3"){
# print(i)}
#  else {
#print("no")
#}}
#df1 <- mutate(df1, Result = ifelse(CCI_mntly$Date > as.Date('2020-12-31'), "Fore", mean(group_by(CCI_mntly$QDate))))
#CCI_qtrly <- CCI_qtrly[1:61,]
CCI_qtrly_ts <- ts(CCI_qtrly$Value)

summary(CCI_qtrly_ts)
plot.ts(CCI_qtrly_ts, main ="Consumer Confidence Austria 2004-2021 Quarterly")

ggplot(CCI_qtrly, aes(x=Date, y=Value)) +
  geom_line(color = "steelblue") +
  theme_light() +
    labs(title = "Consumer Confidence Austria 2006-2021 (Quarterly)", x = "Years", y = "Austria's Consumer Confidence (total)")+
  theme(plot.title = element_text(hjust = 0.5, face ="bold")) +
  scale_x_date(limit=c(as.Date("2006-01-01"),as.Date("2021-01-31")),date_labels="%b %y",date_breaks  ="24 month")

```
########## CCI data financial

```{r}
class(CCI_mntly_fin$Value)
class(CCI_mntly_fin$Date)

CCI_mntly_fin$Date <- as.Date(CCI_mntly_fin$Date)
CCI_mntly_fin$Value <- as.numeric(CCI_mntly_fin$Value)

CCI_mntly_fin_ts <- ts(CCI_mntly_fin$Value)
#summary(CCI_mntly_ts)


### PLOTS ###  HEIk nimmt financial CCI only!!!!! 

plot.ts(CCI_mntly_fin_ts, main ="Consumer Confidence Austria 2006-2021 (Monthly)")

ggplot(CCI_mntly_fin, aes(x=Date, y=Value)) +
  geom_line(color = "steelblue") +
  theme_light() +
    labs(title = "Consumer Confidence Austria 2006-2021 (Monthly)", x = "Years", y = "Austria's Consumer Confidence (total)")+
  theme(plot.title = element_text(hjust = 0.5, face ="bold")) +
  scale_x_date(limit=c(as.Date("2006-01-01"),as.Date("2021-01-31")),date_labels="%b %y",date_breaks  ="24 month")

#### Convert Monthly data into quarterly data!

#CCI_mntly$Date <- as.Date(CCI_mntly$Date, format = "%m/%d/%y")
CCI_mntly_fin <- arrange(CCI_mntly_fin, Date)
CCI_mntly_fin$qdate <- as.yearqtr(CCI_mntly_fin$Date)

CCI_qtrly_fin <- CCI_mntly_fin %>% group_by(qdate) %>%
  summarise_all(mean)

CCI_qtrly_fin <- CCI_qtrly_fin[1:61,]
Data[(Date%in%CCI_qtrly_fin$Date),2] <- (CCI_qtrly_fin$Value)

CCI_qtrly_fin_ts <- ts(CCI_qtrly_fin$Value)


Data[(Date%in%CCI_qtrly_fin$Date),5] <- CCI_qtrly_fin_ts # dates do not match!
 

summary(CCI_qtrly_fin_ts)
plot.ts(CCI_qtrly_fin_ts, main ="Consumer Confidence Austria 2004-2021 Quarterly")

ggplot(CCI_qtrly_fin, aes(x=Date, y=Value)) +
  geom_line(color = "steelblue") +
  theme_light() +
    labs(title = "Consumer Confidence Austria 2006-2021 (Quarterly)", x = "Years", y = "Austria's Consumer Confidence (total)")+
  theme(plot.title = element_text(hjust = 0.5, face ="bold")) +
  scale_x_date(limit=c(as.Date("2006-01-01"),as.Date("2021-01-31")),date_labels="%b %y",date_breaks  ="24 month")

```

########### GOOGLE DATA MIT CATEGORIEN (NOCH NICHT SAMPLING oder SEASONAL...) wie heiki(aber used TRENDECON TEILS)
```{r}
#Indicator_daily_cat


#class(Indicator_daily_cat$time)
#class(Indicator_daily_cat$value)
Google_AT_daily_ts_cat <- ts(Indicator_daily_cat$value)


adf.test(Google_AT_daily_ts_cat) ####  stat have to take friast diff of all seeries
###Plots####
plot.ts(Google_AT_daily_ts_cat, main ="Google Trends TrendEcon Daily Indicator AT")

ggplot(Indicator_daily_cat, aes(x=time, y=value)) +
  geom_line(color = "black") +
  theme_light() +
    labs(title = "Google Trends TrendEcon Daily Indicator AT (2006 - 2021)", x = "Years", y = "Austria's GT daily")+
  theme(plot.title = element_text(hjust = 0.5, face ="bold")) +
  scale_x_date(limit=c(as.Date("2006-01-01"),as.Date("2021-01-31")),date_labels="%b %y",date_breaks  ="24 month")

### Conversion to monthlöy and then quarterly
#Google_AT_daily$Date <- as.Date(Google_AT_daily$Date, format = "%m/%d/%y")
Indicator_daily_cat <- arrange(Indicator_daily_cat, time)
Indicator_daily_cat$mdate <- as.yearmon(Indicator_daily_cat$time)
Indicator_mntl_cat <- Indicator_daily_cat %>% group_by(mdate) %>%
  summarise_all(mean)
Indicator_mntl_cat_ts <- ts(Indicator_mntl_cat$value)
plot.ts(Indicator_mntl_cat_ts, main ="Google Trends data aggregated monthly 2006-2021")

ggplot(Indicator_mntl_cat, aes(x=time, y=value)) +
  geom_line(color = "steelblue") +
  theme_light() +
     labs(title = "Google Trends TrendEcon Daily Indicator AT (2006 - 2021)", x = "Years", y = "Austria's GT (monthly)")+
  theme(plot.title = element_text(hjust = 0.5, face ="bold")) +
  scale_x_date(limit=c(as.Date("2006-01-01"),as.Date("2021-01-31")),date_labels="%b %y",date_breaks  ="24 month")

##### Aggregate to quarterly

Indicator_daily_cat$qdate <- as.yearqtr(Indicator_daily_cat$time)
Indicator_qtrly_cat <- Indicator_daily_cat %>% group_by(qdate) %>%
  summarise_all(mean)

Data[(Date%in%Indicator_qtrly_cat$time),3] <- (Indicator_qtrly_cat$value) # andere DATen... 

#Google_AT_qtrly <- Google_AT_qtrly[1:61,]

Indicator_qtrly_cat_ts <- ts(Indicator_qtrly_cat$value)
summary(Indicator_qtrly_cat_ts)


Data[(Date%in%Indicator_qtrly_cat$Date),6] <- Indicator_qtrly_cat_ts  # andere DATen... 

plot.ts(Indicator_qtrly_cat_ts, main ="Google Trends data aggregated quarterly 2006-2021")
view(Indicator_qtrly_cat)
ggplot(Indicator_qtrly_cat, aes(x=time, y=value)) +
  geom_line(color = "steelblue") +
  theme_light() +
     labs(title = "Google Trends TrendEcon Daily Indicator AT (2006 - 2021)", x = "Years", y = "Austria's GT (quarterly)")+
 theme(plot.title = element_text(hjust = 0.5, face ="bold")) +
  scale_x_date(limit=c(as.Date("2006-01-01"),as.Date("2021-01-31")),date_labels="%b %y",date_breaks  ="24 month")
```

######## google data mit KEYWORDS (INDICATOR VON TRENDECON DIREKT (fertigen)) getrends package und PCA done 
```{r}
# Average ???? 

class(Google_AT_daily$Date)
class(Google_AT_daily$Value)
Google_AT_daily_ts <- ts(Google_AT_daily$Value)

###Plots####
plot.ts(Google_AT_daily_ts, main ="Google Trends TrendEcon Daily Indicator AT")
Google_AT_daily$time <- as.Date(Google_AT_daily$time)

ggplot(Google_AT_daily, aes(x=time, y=value)) +
  geom_line(color = "black") +
  theme_light() +
    labs(title = "Google Trends TrendEcon Daily Indicator AT (2006 - 2021)", x = "Years", y = "Austria's GT daily")+
  theme(plot.title = element_text(hjust = 0.5, face ="bold")) +
  scale_x_date(limit=c(as.Date("2006-01-01"),as.Date("2021-07-20")),date_labels="%b %y",date_breaks  ="24 month")

### Conversion to monthly and then quarterly # direct quar. 
#Google_AT_daily$Date <- as.Date(Google_AT_daily$Date, format = "%m/%d/%y")
Google_AT_daily$Date <- as.Date(Google_AT_daily$Date)
Google_AT_daily <- arrange(Google_AT_daily, Date)
Google_AT_daily$QDate <- as.yearqtr(Google_AT_daily$Date)
Google_AT_daily$QDate  <- as.character(Google_AT_daily$QDate )
#Google_AT_daily$QDate[Google_AT_daily$QDate == "2021 Q3" | Google_AT_daily$QDate == "2021 Q4"] <- "2021 Q2"
Google_AT_daily$QDate[Google_AT_daily$QDate == "2022 Q1"] <- "2021 Q3"  #### 
Google_AT_daily$QDate[Google_AT_daily$QDate == "2021 Q4"] <- "2021 Q3"  #### 
Google_AT_daily$QDate <- as.yearqtr(Google_AT_daily$QDate)
Google_AT_qtrly <- Google_AT_daily %>% group_by(QDate) %>%
  summarise_all(mean)

cor(CCI_qtrly$Value,Google_AT_qtrly$Value)
cor(Google_AT_qtrly$Value,CCI_qtrly$Value)
cor.test(CCI_qtrly$Value,Google_AT_qtrly$Value)
#Google_AT_daily$mdate <- as.yearmon(Google_AT_daily$Date)
#Google_AT_mntly <- Google_AT_daily %>% group_by(mdate) %>%
  #dplyr::summarise_all(mean)

Google_AT_qtrly_ts <- ts(Google_AT_qtrly$Value)
plot.ts(Google_AT_qtrly_ts, main ="Google Trends data aggregated monthly 2006-2021")

ggplot(Google_AT_qtrly, aes(x=Date, y=Value)) +
  geom_line(color = "steelblue") +
  theme_light() +
     labs(title = "Google Trends TrendEcon Daily Indicator AT (2006 - 2021)", x = "Years", y = "Austria's GT (monthly)")+
  theme(plot.title = element_text(hjust = 0.5, face ="bold")) +
  scale_x_date(limit=c(as.Date("2006-01-01"),as.Date("2021-07-20")),date_labels="%b %y",date_breaks  ="24 month")

##### Aggregate to quarterly

Google_AT_daily$qdate <- as.yearqtr(Google_AT_daily$Date)
Google_AT_qtrly <- Google_AT_daily %>% group_by(qdate) %>%
  summarise_all(mean)

Data[(Date%in%Google_AT_qtrly$Date),3] <- (Google_AT_qtrly$Value) # andere DATen... 

#Google_AT_qtrly <- Google_AT_qtrly[1:61,]

Google_AT_qtrly_ts <- ts(Google_AT_qtrly$Value)
summary(Google_AT_qtrly_ts)


Data[(Date%in%Google_AT_qtrly$Date),6] <- Google_AT_qtrly_ts  # andere DATen... 

plot.ts(Google_AT_qtrly_ts, main ="Google Trends data aggregated quarterly 2006-2021")
#view(Google_AT_qtrly)
ggplot(Google_AT_daily, aes(x=time, y=value)) +
  geom_line(color = "steelblue") +
  theme_light() +
     labs(title = "Google Trends TrendEcon Daily Indicator AT (2006 - 2021)", x = "Years", y = "Austria's GT (daily)")+
 theme(plot.title = element_text(hjust = 0.5, face ="bold")) +
  scale_x_date(limit=c(as.Date("2006-01-01"),as.Date("2021-09-30")),date_labels="%b %y",date_breaks  ="24 month")
```

#### Create one dataframe with all info 
##### Average everything to quarterly data
###### do all models: OLS, expandOLS, LOOCV OLS

```{r}
GDP_qtrly<- GDP_qtrly[1:63,]
CCI_qtrly<- CCI_qtrly[1:63,]


data_1 <- cbind(GDP_qtrly,CCI_qtrly$Value, Google_AT_qtrly$Value)
data_1 <- data_1 %>% 
  rename(
    CCI = `CCI_qtrly$Value`,
    Google = `Google_AT_qtrly$Value`,
    GDP = Value
    )

col_order <- c("QDate", "GDP", "CCI", "Google"
               )
data_1 <- data_1[, col_order]
#### differenced data - why differenced!!!! 
##### LAGGED NOT DIFFERENCED!!!!!!
data_1$GDP_T_1 <- lag(data_1$GDP)

#Google_diff <- diff(data_1$Google)
#GDP_T_1
#data_1_diff <- cbind(data_1_diff,GDP_T_1)
#data_1_diff <- cbind(data_1_diff,Google_diff)
#adf.test(GDP_T_1[2:62,]) # stationary!
adf.test(data_1$GDP)# not! stationary,
adf.test(data_1$CCI) #  stationary!!! but only in quarters !!!! 
adf.test(data_1$Google) # not ! stationary  !!!!! at 5% yes!
adf.test(Google_AT_daily$Value) 

adf.test(CCI_qtrly$Value)
adf.test(CCI_mntly$Value)
test <- diff(CCI_mntly$Value)

par(mfrow=c(3,2))
acf(data_1$GDP)
pacf(data_1$GDP)

acf(data_1$CCI)
pacf(data_1$CCI)

acf(data_1$Google)
pacf(data_1$Google)


ar1 <- arima(data_1$GDP,order = c(1,0,0))
ar1
plot(ar1)
rmse(ar1)
```
# Model 1
```{r}
#GDP_qtrly_ts_n <- GDP_qtrly_ts[2:61]
model1 <- lm(GDP ~ GDP_T_1, data = data_1)
model1
summary(model1)

test <- predict(model1$fitted.values)
test

plot(test)
#sqrt(mean((GDP_qtrly_ts_n - model1$fitted.values)^2))
rmse(data_1$GDP, model1$fitted.values)
#AIC(model1)
#BIC(model1)
```
# Model 2
```{r}
# Problem mit variable length brauch 3 month mov average
model2 <- lm(GDP ~ CCI, data = data_1)
model2
summary(model2)
predict()
rmse(data_1$GDP, model2$fitted.values)
```
# Model 3
```{r}
# Problem mit variable length brauch 3 month mov average
#model3 <- lm(GDP_qtrly_ts ~ AT_INDEX_qtrly_ts)
model3 <- lm(GDP ~ Google, data = data_1)
model3
summary(model3)
rmse(data_1$GDP, model3$fitted.values)
```
# Model 4
```{r}
#CCI_qtrly_ts_n <- CCI_qtrly_ts[2:61]
model4 <- lm(GDP ~ GDP_T_1 + CCI, data = data_1 )
model4
summary(model4)
rmse(data_1$GDP,model4$fitted.values)
```
# Model 5
```{r}
#Google_AT_qtrly_ts_n_2 <- Google_AT_qtrly_ts[2:61]
model5 <- lm(GDP ~ GDP_T_1 + Google, data = data_1 )
model5
summary(model5)
rmse(data_1$GDP, model5$fitted.values)
```
# Model 6
```{r}
model6 <- lm(GDP ~ GDP_T_1 + CCI + Google, data = data_1)
model6
summary(model6)
rmse(data_1$GDP, model6$fitted.values)
```

```{r}
## higer RNSE !!! 
model7 <- lm(GDP ~ CCI + Google, data = data_1)
model7
summary(model7)
rmse(data_1$GDP, model7$fitted.values)
```

##### NOW  DO THE SAME JUST WITH NOT AVERAGED DATA BUT SELECT FIRST MONTH/ DAY ...
### CREATE NEW DATA FRAME! 

```{r}
## Select the last day of the artificial Quarter!

#Google_AT_daily$QDate <- as.yearqtr(Google_AT_daily$Date)
#Google_AT_daily$QDate <- as.character(Google_AT_daily$QDate)
Google_AT_daily$QDate[Google_AT_daily$QDate == "2021 Q3" | Google_AT_daily$QDate == "2021 Q4"] <- "2021 Q1"
#Google_AT_daily$QDate <- as.yearqtr(Google_AT_daily$QDate)
Google_AT_qtrly_M <- Google_AT_daily %>% group_by(QDate) %>%
  filter(Date==max(Date)) %>% 
  ungroup 

## Select the last day of the Quarter!
#CCI_mntly$QDate <- as.yearqtr(CCI_mntly$Date)
#CCI_mntly$QDate <- as.character(CCI_mntly$QDate)
CCI_mntly$QDate <- as.yearqtr(CCI_mntly$QDate)
CCI_mntly$QDate[CCI_mntly$QDate == "2021 Q3"] <- "2021 Q2"
CCI_qtrly_M <- CCI_mntly %>% group_by(QDate) %>%
  filter(Date==max(Date)) %>% 
  ungroup 

# create one dataframe
data_2 <- as.data.frame(cbind(CCI_qtrly_M, Google_AT_qtrly_M$Value))
data_2
data_2 <- as_data_frame(cbind(data_2, GDP_qtrly$Value))
data_2$Value <- as.numeric(data_2$Value)

data_2 <- data_2 %>% rename(CCI = Value,
                            GDP = `GDP_qtrly$Value`,
                            Google =`Google_AT_qtrly_M$Value`)

col_order <- c("QDate", "Date", "GDP", "CCI", "Google"
               )
data_2 <- data_2[, col_order]
#### differenced data - why differenced!!!! 
##### LAGGED NOT DIFFERENCED!!!!!!
data_2$GDP_T_1 <- lag(data_2$GDP)

# checking for stationarity
adf.test(data_2$GDP) # not! stationary, but how ??? cannot use difference !!!! 
adf.test(data_2$CCI) # not stationary, 0.02
adf.test(data_2$Google) # not stationary, 0.02

```

### Regression models same as above ! 

Model 1 - Not Average
```{r}
model1_Q <- lm(GDP ~ GDP_T_1, data = data_2)
summary(model1_Q)
rmse(data_2$GDP, model1_Q$fitted.values)
rmse
x <- rnorm(15)
y <- x + rnorm(15)
predict(lm(y ~ x))
new <- data.frame(x = seq(-3, 3, 0.5))
predict(lm(y ~ x), new, se.fit = TRUE)
```

Model 2 - Not Average
```{r}
model2_Q <- lm(GDP ~ CCI, data = data_2)
model2_Q
summary(model2_Q)
beta_1 <- model2_Q$coefficients[2]
intercept = model2_Q$coefficients[1]

forecast_gdp_1 = intercept + beta_1*(CCI_mntly[1:62,2])
forecast_gdp_1
predict2_Q <- predict.lm(model2_Q,data_1)
predict2_Q
#predict2_Q

rmse(data_2$GDP, model2_Q$fitted.values)

```

Model 3 - Not Average
```{r}
model3_Q <- lm(GDP ~ Google, data = data_2)
model3_Q
summary(model3_Q)

rmse(data_2$GDP, model3_Q$fitted.values)
```

Model 4 - Not Average
```{r}
model4_Q <- lm(GDP ~ GDP_T_1 + CCI, data = data_2)
model4_Q
summary(model4_Q)

rmse(data_2$GDP, model4_Q$fitted.values)
```
Model 5 - Not Average
```{r}
model5_Q <- lm(GDP ~ GDP_T_1 + Google, data = data_2)
model5_Q
summary(model5_Q)

rmse(data_2$GDP, model5_Q$fitted.values)
```

Model 6 - Not Average
```{r}
model6_Q <- lm(GDP ~ GDP_T_1 + CCI +Google, data = data_2)
model6_Q
summary(model6_Q)

rmse(data_2$GDP, model6_Q$fitted.values)
```

Model 7 - Not Average
```{r}
model7_Q <- lm(GDP ~ CCI +Google, data = data_2)
model7_Q
summary(model7_Q)
rmse(data_2$GDP, model7_Q$fitted.values)
```
##### NOW  DO THE SAME JUST WITH Cross Validation! Can I even do it ?? resampling and time series!
###### First with Averaged data 
Model1
```{r}
ctrl <- trainControl(method = "LOOCV")
model1_CV <- train(GDP ~ GDP_T_1, data = data_1, method = "lm", trControl = ctrl)
print(model1_CV)
```
Model2
```{r}
ctrl <- trainControl(method = "LOOCV")
model2_CV <- train(GDP ~ CCI, data = data_1, method = "lm", trControl = ctrl)
print(model2_CV)
```

Model3
```{r}
ctrl <- trainControl(method = "LOOCV")
model3_CV <- train(GDP ~ Google, data = data_1, method = "lm", trControl = ctrl)
print(model3_CV)
```

Model4
```{r}
ctrl <- trainControl(method = "LOOCV")
model4_CV <- train(GDP ~ GDP_T_1 +CCI, data = data_1, method = "lm", trControl = ctrl)
print(model4_CV)
```

Model5
```{r}
ctrl <- trainControl(method = "LOOCV")
model5_CV <- train(GDP ~ GDP_T_1 + Google, data = data_1, method = "lm", trControl = ctrl)
print(model5_CV)
```

Model6
```{r}
ctrl <- trainControl(method = "LOOCV")
model6_CV <- train(GDP ~ GDP_T_1 + Google + CCI , data = data_1, method = "lm", trControl = ctrl)
print(model6_CV)
```

Model7
```{r}
ctrl <- trainControl(method = "LOOCV")
model7_CV <- train(GDP ~ Google + CCI , data = data_1, method = "lm", trControl = ctrl)
print(model7_CV)
```
##### NOW  DO THE SAME JUST WITH Cross Validation! Can I even do it ?? resampling and time series!
###### First with Last month data 
Model1
```{r}
# sollte OLS sein weil ich kein train/test habe??? defautl? 
ctrl <- trainControl(method = "LOOCV")
model1_Q_CV <- train(GDP ~ GDP_T_1_Q, data = data_2_diff, method = "lm", trControl = ctrl)
print(model1_Q_CV)
```
Model2
```{r}
ctrl <- trainControl(method = "LOOCV")
model2_Q_CV <- train(GDP ~ CCI, data = data_2, method = "lm", trControl = ctrl)
print(model2_Q_CV)
```
Model3
```{r}
ctrl <- trainControl(method = "LOOCV")
model3_Q_CV <- train(GDP ~ Google, data = data_2, method = "lm", trControl = ctrl)
print(model3_Q_CV)
```
Model4
```{r}
ctrl <- trainControl(method = "LOOCV")
model4_Q_CV <- train(GDP ~ GDP_T_1_Q + CCI, data = data_2_diff, method = "lm", trControl = ctrl)
print(model4_Q_CV)
```
Model5
```{r}
ctrl <- trainControl(method = "LOOCV")
model5_Q_CV <- train(GDP ~ GDP_T_1_Q + Google, data = data_2_diff, method = "lm", trControl = ctrl)
print(model5_Q_CV)
```
Model6
```{r}
ctrl <- trainControl(method = "LOOCV")
model6_Q_CV <- train(GDP ~ GDP_T_1_Q + Google + CCI , data = data_2_diff, method = "lm", trControl = ctrl)
print(model6_Q_CV)
```
Model7
```{r}
ctrl <- trainControl(method = "LOOCV")
model7_Q_CV <- train(GDP ~ Google + CCI , data = data_2, method = "lm", trControl = ctrl)
print(model6_Q_CV)
```

## OLS MIT EXPANDING WINDOW!
# FUNCTIONS 

```{r}
dep_var   <- "GDP"
data_1$GDP_1 <- lead(data_1$GDP)
#data_2_diff[,"GDP_lead"] <- lead(data_2_diff[,dep_var]) #new column for future returns, bruach ich das???  ###ANSVCHAUN WHAT DOES !!
#data_1[,"GDP_lead"] <- lead(data_1[,dep_var])
#indep_var <- c("GDP_T_1")
#indep_var <- c("CCI", "Google","GDP_T_1")
#formula_ols_all_rev = GDP ~ GDP_T_1  #data_1_diff
#formula_ols_all_rev = GDP ~ CCI
##formula_ols_all_rev = GDP ~ Google 
#formula_ols_all_rev = GDP ~ GDP_T_1 + CCI  #data_1_diff
#formula_ols_all_rev = GDP ~ GDP_T_1 + Google #data_1_diff
#formula_ols_all_rev = GDP ~ GDP_T_1 + CCI + Google #data_1_diff
#formula_ols_all_rev = GDP ~ CCI + Google
expanding_window_OLS <- function(data, dep_var, start = 12){ # change to 12 
  expanding_OLS <- list() # empty vector
  residuals <- list() # empty vector
  j <- 0
  for(i in start:nrow(data)){
    j <- j+1
    expanding_OLS[[j]] <- lm(formula = formula_ols_all_rev, data = data[1:(i-1),])
  }
  return(expanding_OLS)
}
#expanding_OLS <- expanding_window_OLS(data_1_diff, dep_var, start = 12)

# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.

error_OLS_model <- function(data, expanding_OLS, indep_var, start = 1){
  error_OLS <- c() 
  #predicted_OLS <- list() # empty vector
  j <- 0
  for(i in start:nrow(data)){ 
    j <- j+1
      # geht durch alle 12-1 rows!
    expanding_OLS <- lm(formula = formula_ols_all_rev, data = data[1:(i-1),])
    predicted_OLS  <- predict.lm(expanding_OLS, newdata = data[i,])# hier forecst v<irablr??
    # trying to predict value i
    error_OLS[j] <- as.numeric(predicted_OLS - data[i,"GDP_1"]) # second is predcted vlaue ! FORECASTING !!! when I include GDP_lead butthen I also have tom do it in the formula !
  }
  return(error_OLS)
 # return(predicted_OLS)
}

#predicted_OLS
#error_OLS <- error_OLS_model(data_1_diff, expanding_OLS, indep_var, start = 12)
##################################

#class(error_OLS)
#error_OLS <-error_OLS[!is.na(error_OLS)]
#MAE_OLS_OOS <- mean(abs(error_OLS))
#MAE_OLS_OOS
#MSE_OLS_OOS    <- mean(error_OLS^2)
#MSE_OLS_OOS
#OOS_OLS   <- cumsum(error_OLS^2)
#OOS_OLS
# we do I not get prediction??
#MSE_IS <- rmse(data_1_diff$ret_fut,predicted_OLS)

# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS_model <- function(expanding_OLS, indep_var, start = 12){
  resid_OLS <- list() # empty vector
  for(j in 1:length(expanding_OLS)){ 
    resid_OLS[[j]] <- resid(expanding_OLS[[j]])
  }
  return(resid_OLS)
}
#resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
#final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
#final_resid_OLS
#min(final_resid_OLS)
#MSE_OLS_IS    <- mean(final_resid_OLS^2)
#MSE_OLS_IS

```

Model 1 Expanding Window - Averaged Data 
```{r}

indep_var <- c("GDP_T_1")
formula_ols_all_rev = GDP ~ GDP_T_1
expanding_OLS <- expanding_window_OLS(data_1[2:62,], dep_var, start = 12) # muss datenset cutten weg LAG! nicht 13 damit erstes saple 12 hat???
expanding_OLS
# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_1[2:62,], expanding_OLS, indep_var, start = 12)

error_OLS <-error_OLS[!is.na(error_OLS)]
# for AIC ID only need one model! 
MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
RMSE_OLS_OOS    <- sqrt(mean(error_OLS^2))  ### RMSE ????? sq()
RMSE_OLS_OOS
#MSE_OS <- rmse(data_1_diff$GDP_lead,predicted_OLS)
#RMSE_OS
#OOS_OLS   <- cumsum(error_OLS^2)
#OOS_OLS

# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS


MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
#RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
 
```

Model 2 Expanding Window - Averaged Data 
```{r}
indep_var <- c("CCI")
formula_ols_all_rev = GDP ~ CCI 
expanding_OLS <- expanding_window_OLS(data_1, dep_var, start = 12)

# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_1, expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]

MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
MSE_OLS_OOS    <- sqrt(mean(error_OLS^2)) 
MSE_OLS_OOS
RMSE_OS <- rmse(data_1$GDP_lead,predicted_OLS)
RMSE_OS
OOS_OLS   <- cumsum(error_OLS^2)
OOS_OLS

# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS 

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)

residar1 <- resid(expanding_OLS)
par(mfrow = c(2,2))
plot(final_resid_OLS, main = "Residual plot")
plot(final_resid_OLS^2, main = "Squared residuals")
library(car)

durbinWatsonTest(expanding_OLS[[1]]) # cannot reeject H_0 so errors arre not autocorrelated!!!! 


par(mfrow = c(2,2))
acf_resid <- acf(final_resid_OLS, main = "Autocorrelation of residuals", plot = FALSE)
acf_resid$lag <- acf_resid$lag*4
plot(acf_resid, main = c("Autocorrelation of residuals"), xlab = "Lag (Quarters)")
hist(final_resid_OLS, main = "Histogram of residuals")
qqnorm(final_resid_OLS)

Box.test(final_resid_OLS, type = "Ljung")
jarque.bera.test(final_resid_OLS)



adf.test(final_resid_OLS) # this residuals are stationary, have no cointegration relationship 
po.test(log_data, demean = T)
coint.test(log(C), regressors)
```

Model 3 Expanding Window - Averaged Data 
```{r}
indep_var <- c("Google")
formula_ols_all_rev = GDP ~ Google 
expanding_OLS <- expanding_window_OLS(data_1, dep_var, start = 12)

# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_1, expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]

MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
MSE_OLS_OOS    <- sqrt(mean(error_OLS^2))
MSE_OLS_OOS
RMSE_OS <- rmse(data_1$GDP_lead,predicted_OLS)
RMSE_OS
OOS_OLS   <- cumsum(error_OLS^2)
OOS_OLS

# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2)/51)
MSE_OLS_IS
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)




resid_OLS2= resid_OLS[[length(resid_OLS)]][11:length(resid_OLS[[length(resid_OLS)]])]
resid_OLS2
```

Model 4 Expanding Window - Averaged Data 
```{r}
indep_var <- c("GDP_T_1", "CCI")
formula_ols_all_rev = GDP ~ GDP_T_1 + CCI
expanding_OLS <- expanding_window_OLS(data_1[2:62,], dep_var, start = 12)

# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_1[2:62,], expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]

MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
MSE_OLS_OOS    <- sqrt(mean(error_OLS^2))  ### RMSE ????? sq()
MSE_OLS_OOS
RMSE_OS <- rmse(data_1_diff$GDP_lead,predicted_OLS)
RMSE_OS
#OOS_OLS   <- cumsum(error_OLS^2)
#OOS_OLS

# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
```

Model 5 Expanding Window - Averaged Data 
```{r}
indep_var <- c("GDP_T_1", "Google")
formula_ols_all_rev = GDP ~ GDP_T_1 + Google
expanding_OLS <- expanding_window_OLS(data_1, dep_var, start = 12)
# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_1, expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]

MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
MSE_OLS_OOS    <- sqrt(mean(error_OLS^2))   ### RMSE ????? sq()
MSE_OLS_OOS
RMSE_OS <- rmse(data_1_diff$GDP_lead,predicted_OLS)
RMSE_OS
#OOS_OLS   <- cumsum(error_OLS^2)
#OOS_OLS
# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
```

Model 6 Expanding Window - Averaged Data 
```{r}
indep_var <- c("GDP_T_1","CCI", "Google")
formula_ols_all_rev = GDP ~ GDP_T_1 + CCI + Google
expanding_OLS <- expanding_window_OLS(data_1, dep_var, start = 12)

# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_1, expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]
error_OLS

MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
MSE_OLS_OOS    <- sqrt(mean(error_OLS^2))  ### RMSE ????? sq()
MSE_OLS_OOS
RMSE_OS <- rmse(data_1_diff$GDP_lead,predicted_OLS)
RMSE_OS
OOS_OLS   <- cumsum(error_OLS^2)
OOS_OLS
# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1$GDP,x$c.0.789213143225476..0.745531842971447..0.762904582636493..0.780697544875677..)
RMSE_OS


sqrt(sum((wage2_test$lwage-wage2_test$predicted_tree)^2/nrow(wage2_test),na.rm=T))
```

Model 7 Expanding Window - Averaged Data 
```{r}
indep_var <- c("Google", "CCI")
formula_ols_all_rev = GDP ~ Google + CCI  
expanding_OLS <- expanding_window_OLS(data_1, dep_var, start = 12)

# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_1, expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]

MAE_OLS_OOS <- sqrt(mean(abs(error_OLS)))
MAE_OLS_OOS
MSE_OLS_OOS    <- sqrt(mean(error_OLS^2)) 
MSE_OLS_OOS
RMSE_OS <- rmse(data_1$GDP_lead,predicted_OLS)
RMSE_OS
OOS_OLS   <- cumsum(error_OLS^2)
OOS_OLS
# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)
```


```{r}
predicting_window_OLS <- function(data,expanding_OLS, indep_var, start = 12){
  predicted_OLS <- list() # empty vector
  residuals <- list() # empty vector
  j <- 0
  for(i in start:nrow(data)){
    j <- j+1
   expanding_OLS <- lm(formula = formula_ols_all_rev, data = data[1:(i-1),])
   predicted_OLS[j] <- predict.lm(expanding_OLS, newdata = data[i,"GDP_lead"])
  }
  return(predicted_OLS)
}

predicted_OLS <- predicting_window_OLS(Data, expanding_OLS, indep_var, start = 13)
x<- as.list(predicted_OLS)

x <-do.call(rbind.data.frame, predicted_OLS)
x <- cbind(time,x)
time <- data_1[12:62,2]

ts_plot(x)

```

#### OLS MIT EXPANDING WINDOW!
## NOT AVERAGED DATA BUT LAST MONTH/ DAY
# Same models !
Model 1 Expanding Window -  LAST MONTH/ DAY data 
```{r}
data_2$GDP_1 <- lead(data_2$GDP)
indep_var <- c("GDP_T_1")
formula_ols_all_rev = GDP ~ GDP_T_1
expanding_OLS <- expanding_window_OLS(data_2, dep_var, start = 12)


# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_2, expanding_OLS, indep_var, start = 12)

error_OLS <-error_OLS[!is.na(error_OLS)]

# for AIC ID only need one model! 
MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
RMSE_OLS_OOS    <- sqrt(mean(error_OLS^2))   ### RMSE ????? sq()
RMSE_OLS_OOS
#MSE_OS <- rmse(data_1_diff$GDP_lead,predicted_OLS)
#RMSE_OS
#OOS_OLS   <- cumsum(error_OLS^2)
#OOS_OLS

# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
#RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
 
```

Model 2 Expanding Window - LAST MONTH/ DAY data 
```{r}
indep_var <- c("CCI")
formula_ols_all_rev = GDP ~ CCI 
expanding_OLS <- expanding_window_OLS(data_2, dep_var, start = 12)

# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_2, expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]

MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
MSE_OLS_OOS    <- sqrt(mean(error_OLS^2)) 
MSE_OLS_OOS
RMSE_OS <- rmse(data_1$GDP_lead,predicted_OLS)
RMSE_OS
OOS_OLS   <- cumsum(error_OLS^2)
OOS_OLS

# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(error_OLS^2)) 
MSE_OLS_IS
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)
```

Model 3 Expanding Window - LAST MONTH/ DAY data 
```{r}
indep_var <- c("Google")
formula_ols_all_rev = GDP ~ Google 
expanding_OLS <- expanding_window_OLS(data_2, dep_var, start = 12)

# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_2, expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]

MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
MSE_OLS_OOS    <- sqrt(mean(error_OLS^2)) 
MSE_OLS_OOS
RMSE_OS <- rmse(data_1$GDP_lead,predicted_OLS)
RMSE_OS
OOS_OLS   <- cumsum(error_OLS^2)
OOS_OLS

# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)
```

Model 4 Expanding Window - LAST MONTH/ DAY data 
```{r}
indep_var <- c("GDP_T_1", "CCI")
formula_ols_all_rev = GDP ~ GDP_T_1 + CCI
expanding_OLS <- expanding_window_OLS(data_2, dep_var, start = 12)

# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_2, expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]

MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
MSE_OLS_OOS    <- sqrt(mean(error_OLS^2)) ## RMSE ????? sq()
MSE_OLS_OOS
RMSE_OS <- rmse(data_1$GDP,predicted_OLS[[1]])
RMSE_OS
#OOS_OLS   <- cumsum(error_OLS^2)
#OOS_OLS

# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
```

Model 5 Expanding Window - LAST MONTH/ DAY data 
```{r}
indep_var <- c("GDP_T_1", "Google")
formula_ols_all_rev = GDP ~ GDP_T_1 + Google
expanding_OLS <- expanding_window_OLS(data_2, dep_var, start = 12)
# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_2, expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]

MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
MSE_OLS_OOS    <-sqrt(mean(error_OLS^2))   ### RMSE ????? sq()
MSE_OLS_OOS
RMSE_OS <- rmse(data_1_diff$GDP_lead,predicted_OLS)
RMSE_OS
#OOS_OLS   <- cumsum(error_OLS^2)
#OOS_OLS
# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
```

Model 6 Expanding Window - LAST MONTH/ DAY data 
```{r}
indep_var <- c("GDP_T_1","CCI", "Google")
formula_ols_all_rev = GDP ~ GDP_T_1 + CCI + Google
expanding_OLS <- expanding_window_OLS(data_2, dep_var, start = 12)

# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_2, expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]

MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
MSE_OLS_OOS    <- sqrt(mean(error_OLS^2))   ### RMSE ????? sq()
MSE_OLS_OOS
RMSE_OS <- rmse(data_1_diff$GDP_lead,predicted_OLS)
RMSE_OS
OOS_OLS   <- cumsum(error_OLS^2)
OOS_OLS
# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1_diff$GDP,predicted_OLS)
```

Model 7 Expanding Window - LAST MONTH/ DAY data 
```{r}
indep_var <- c("Google", "CCI")
formula_ols_all_rev = GDP ~ Google + CCI  
expanding_OLS <- expanding_window_OLS(data_2, dep_var, start = 12)

# OOS error terms---------------------------------------------------------------
# OOS = If you are forecasting for an observation that was not part of the data sample - it is Out-Of-Sample forecast.
error_OLS <- error_OLS_model(data_2, expanding_OLS, indep_var, start = 12)
error_OLS <-error_OLS[!is.na(error_OLS)]

MAE_OLS_OOS <- mean(abs(error_OLS))
MAE_OLS_OOS
x <- (mean(error_OLS))
x
MSE_OLS_OOS    <- sqrt(mean(error_OLS^2))
MSE_OLS_OOS
RMSE_OS <- rmse(data_1$GDP_lead,predicted_OLS)
RMSE_OS
OOS_OLS   <- cumsum(error_OLS^2)
OOS_OLS
# IS error terms----------------------------------------------------------------
# IS: If you are forecasting for an observation that was part of the data sample - it is in-sample forecast.
resid_OLS <- resid_OLS_model(expanding_OLS, indep_var, start = 12)
final_resid_OLS <- resid_OLS[[length(resid_OLS)]]
final_resid_OLS

MSE_OLS_IS    <- sqrt(mean(final_resid_OLS^2))
MSE_OLS_IS
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)
RMSE_OS <- rmse(data_1$GDP,predicted_OLS)
```

```{r}
dep_var   <- "GDP"

expanding_window_OLS <- function(data, dep_var, start = 13){ # change to 12 
  expanding_OLS <- list() # empty vector
  residuals <- list() # empty vector
  predicted_OLS <- list()
  i <- 0
  for(t in start:nrow(data)){
    i <- i+1
    expanding_OLS[[i]] <- lm(formula = formula_ols_all_rev, data = data[1:(t-1),])
    predicted_OLS[i] <- predict(expanding_OLS, newdata = data[t,])
    newlist <- list(expanding_OLS,predicted_OLS)
  }
  return(newlist)
}

```
